/**
 * MobileDateSelector v0.0.1 - 
 * http://emmasax.github.io/mobile-date-selector/ - An intuitive date picker for mobile devices.
 *
 * Copyright 2014, Emma Patricios - http://punkchip.com
 *
 * Released under the MIT license - http://opensource.org/licenses/MIT
 */
(function(e,c,a,f){var d="mobileDateSelector";function b(j,g){defaults={showBlanks:true,errorMessage:"Sorry, that is not a valid date.",selectorClass:"mds-"+e(j).attr("class")+"-"+e(j).index(),longMonths:true,numYears:10,startYear:(new Date).getFullYear(),breakPoint:568,selectWrapper:"",forcePlugin:false,demoMode:false,day:"",month:"",year:"",monthNumber:"",wholeDate:"",days:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsLong:["January","February","March","April","May","June","July","August","September","October","November","December"],years:[],daysSelect:"",monthsSelect:"",yearsSelect:""};this.element=j;this.settings=e.extend({},defaults,g);this._defaults=defaults;this._name=d;var h=a.createElement("input");h.setAttribute("type","date");if(this.settings.forcePlugin||h.type=="text"){this.init()}}b.prototype={init:function(){var j=e(c),h=this;if(this.settings.showBlanks){this.settings.years.push("");this.settings.monthsShort.unshift("");this.settings.monthsLong.unshift("");this.settings.days.unshift("")}else{this.settings.years.push("Select");this.settings.monthsShort.unshift("Select");this.settings.monthsLong.unshift("Select");this.settings.days.unshift("Select")}for(i=0;i<this.settings.numYears;i++){this.settings.years.push(this.settings.startYear);this.settings.startYear++}var g=(this.settings.longMonths?this.settings.monthsLong:this.settings.monthsShort);daysOptions="",monthsOptions="",yearsOptions="";for(i=0;i<this.settings.days.length;i++){daysOptions+="<option>"+this.settings.days[i]+"</option>"}for(i=0;i<g.length;i++){monthsOptions+="<option value='"+i+"'>"+g[i]+"</option>"}for(i=0;i<this.settings.years.length;i++){yearsOptions+="<option>"+this.settings.years[i]+"</option>"}this.settings.daysSelect='<label for="day">Date</label><select id="mds-day">'+daysOptions+"</select>";this.settings.monthsSelect='<label for="month">Month</label><select id="mds-month">'+monthsOptions+"</select>";this.settings.yearsSelect='<label for="year">Year</label><select id="mds-year">'+yearsOptions+"</select>";j.resize(function(){h.addToPage(h.element,h.settings)});this.addToPage(this.element,this.settings);e("#mds-day, #mds-month, #mds-year").wrap(this.settings.selectWrapper)},addToPage:function(){var g=e("."+this.settings.selectorClass),h=e("label[for="+e(this.element).attr("id")+"]"),j=this,k=e(c);if(k.width()<this.settings.breakPoint){if(g.length==0){h.hide();if(!this.settings.demoMode){e(this.element).hide()}e(this.element).after('<ul class="mds-mobile-date '+this.settings.selectorClass+'"><li>'+this.settings.daysSelect+"</li><li>"+this.settings.monthsSelect+"</li><li>"+this.settings.yearsSelect+"</li></ul>");e("."+this.settings.selectorClass+" select#mds-day").on("change",function(){j.buildDayDate(j.element,j.settings)});e("."+this.settings.selectorClass+" select#mds-month").on("change",function(){j.buildMonthDate(j.element,j.settings)});e("."+this.settings.selectorClass+" select#mds-year").on("change",function(){j.buildYearDate(j.element,j.settings)})}}else{if(g.length>0){e(this.element).show();h.show();g.remove();e("."+this.settings.selectorClass+"-error").remove()}}},buildDayDate:function(){this.settings.day=e("."+this.settings.selectorClass+" select#mds-day").find(":selected").val();if(this.settings.day<10){this.settings.day="0"+this.settings.day}this.setDate()},buildMonthDate:function(){this.settings.month=e("."+this.settings.selectorClass+" select#mds-month").find(":selected").text();this.settings.monthNumber=e("."+this.settings.selectorClass+" select#mds-month").find(":selected").val();if(this.settings.monthNumber<10){this.settings.monthNumber="0"+this.settings.monthNumber}this.setDate()},buildYearDate:function(){this.settings.year=e("."+this.settings.selectorClass+" select#mds-year").find(":selected").text();this.setDate()},setDate:function(){this.settings.wholeDate=this.settings.year+"-"+this.settings.monthNumber+"-"+this.settings.day;e("."+this.settings.selectorClass+"-error").remove();if(this.settings.day!=""&&this.settings.month!=""&&this.settings.year!=""){if(this.isValidDate(this.settings.day+" "+this.settings.monthNumber+" "+this.settings.year)){e(this.element).val(this.settings.wholeDate)}else{e("."+this.settings.selectorClass).after('<div class="'+this.settings.selectorClass+'-error">'+this.settings.errorMessage+"</div")}}},isValidDate:function(j){var k=j.split(" ");var n=k[2],g=k[1],l=k[0];var h=[31,28,31,30,31,30,31,31,30,31,30,31];if((!(n%4)&&n%100)||!(n%400)){h[1]=29}return l<=h[--g]}};e.fn[d]=function(g){this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,g))}});return this}})(jQuery,window,document);